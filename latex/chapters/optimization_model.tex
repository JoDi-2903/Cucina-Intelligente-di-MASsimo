%!TEX root = ../main.tex

\chapter{Mathematische Formulierung des Optimierungsproblems}
Wir haben ein engagiertes Team von Mitarbeitern und eine Reihe von Einschränkungen, die sich vor allem aus dem Arbeitsschutzgesetz ergeben. Einige Mitarbeiter arbeiten weniger Stunden und Schichten, während andere mehr arbeiten. Das muss nicht ausgewogen oder fair sein, sondern muss bestmöglich zur Zielfunktion beitragen. Die Herausforderung besteht darin, die Mitarbeiter für den nächsten Tag so einzusetzen, dass der Gesamtgewinn maximiert wird. Die Mitarbeiter werden im Laufe des Tages weder versetzt noch ausgewechselt. Darüber hinaus hat jeder Mitarbeiter einen spezifischen \mintinline{text}{customer_capacity}-Faktor, der seine Effizienz oder sein Qualifikationsniveau darstellt -- je höher dieser Faktor, desto höher das Gehalt des Mitarbeiters.

Nachfolgend wird das Optimierungsproblems der Schichtplanung mathematisch mit allen erforderlichen Entscheidungsvariablen, Parametern, Zielfunktionen und Nebenbedingungen definiert.

\subsection*{Entscheidungsvariablen}
Sei:
\begin{itemize}
    \item $ x_{a,t} \in \{0, 1\} $\\
          Eine binäre Variable, die angibt, ob der Service-Agent $ a $ im Zeitfenster $ t = \{ 0, \dots, 23\} $ arbeitet (1 = arbeitet, 0 = arbeitet nicht).
    \item $ y_{a,s} \in \{0, 1\} $\\
          Eine binäre Variable, die angibt, ob der Service-Agent $ a $ der Schicht $ s $ zugewiesen wurde (1 = zugewiesen, 0 = nicht zugewiesen).
\end{itemize}

\subsection*{Parameter}
Sei:
\begin{itemize}
    \item $ c_a $\\
          Gehalt pro Zeitschritt für den Service-Agenten $ a $.
    \item $ p_a $\\
          Kapazität des Service-Agenten $ a $. Gibt an, wie viele Kunden er gleichzeitig in einem Zeitschritt bedienen kann.
    \item $ v_t $\\
          Prognostizierte Anzahl an Besuchern im Zeitfenster $ t $.
    \item $ S_a = 3 $\\
          Maximale Anzahl an Schichten, die ein Service-Agent $ a $ pro Tag arbeiten darf.
    \item $ T = \{1, 2, ..., 144\}$\\
          Menge aller Zeitfenster eines Tages, wobei jedes Zeitfenster eine Dauer von 10 Minuten hat (144 Zeitfenster für einen Zeitraum von 24 Stunden).
    \item $ S = \left\{ \left[0, 1, 2, 3, 4, 5 \right], \left[ 6, 7, 8, 9, 10, 11 \right] , \left[ 12, 13, 14, 15, 16, 17 \right] , \left[ 18, 19, 20, 21, 22, 23 \right] \right\} $\\
          Stunden der Schichten, wobei jede Schicht 6 Stunden dauert
    % \item $ S = \left\{ \left[ i, i+1, i+2, i+3, i+4, i+5 \right] \mid i \in \left\{0, 1, 2, \dots, 18\right\} \right\} $
\end{itemize}

\subsection*{Zielfunktion}
Das Ziel ist es, den Gewinn des Restaurants zu maximieren, indem die Kundennachfrage erfüllt und gleichzeitig die Personalkosten minimiert werden. Die Zielfunktion lautet:
$$\text{Minimiere } f(x) = \sum_{t \in T} \sum_{a \in A} c_a x_{a,t}$$
Dabei:
\begin{itemize}
    \item Der erste Term repräsentiert den Gesamterlös basierend auf der Anzahl der bedienten Kunden. Dieser wird durch die prognostizierte Besuchernachfrage ($v_t$) und die Gesamtkapazität der arbeitenden Agenten ($p_a x_{a,t}$) begrenzt.
    \item Der zweite Term repräsentiert die gesamten Gehaltskosten für alle arbeitenden Agenten.
\end{itemize}

\subsection*{Nebenbedingungen}
\begin{enumerate}
    \item \textbf{Erfüllung der Nachfrage}\\
          Die Gesamtkapazität der zugewiesenen Agenten muss mindestens so groß sein wie die Besuchernachfrage in jedem Zeitfenster:
          $$\sum_{a \in A} p_a x_{a,t} \geq v_t, \quad \forall t \in T$$
    \item \textbf{Maximale Arbeitszeit pro Agent}\\
          Jeder Agent darf maximal $M_a = 48$ Zeitschritte pro Tag arbeiten:
          $$\sum_{t \in T} x_{a,t} \leq M_a, \quad \forall a \in A$$
    \item \textbf{Mapping der Service Agents auf Schichten}\\
        Wenn ein Agent in einer Schicht arbeitet, muss die binäre Variable $x$ für den Zeitschritt den selben Wert haben wie die Variable $y$ für die Schicht.
        Daraus ergibt sich folgende Implikation: $ y_{a,s} = 1 \Rightarrow x_{a,t} = 1, \quad \forall t \in T , s \in S $.\\
        Gleichzeitig muss die umgekehrte Implikation gelten, denn für jeden Zeitschritt, an dem der Service Agent arbeitet, ist er der zugehörigen Schicht zugewiesen: $ x_{a,t}  = 1 \Rightarrow y_{a,s} = 1, \quad \forall t \in T , s \in S$.\\
        Durch eine Und-Verknüpfung können die beiden Gleichungen anschließend kombiniert werden.

        Da Implikationen in der PyOptInterface-Syntax nicht möglich sind, muss die Formel umformuliert werden:
        \begin{align*}
            c_1 & = y_{a,s} \leq x_{a,t}, & \quad \forall t \in T , s \in S\\
            c_2 & = x_{a,t} \leq y_{a,s}, & \quad \forall t \in T , s \in S\\
            c_{ges} & = c_1 \land c_2\\
            y_{a,s} \leq x_{a,t} & \land x_{a,t} \leq y_{a,s}, & \quad \forall t \in T , s \in S\\
            y_{a,s} - x_{a,t} \leq 0 & \land x_{a,t} - y_{a,s} \leq 0, & \quad \forall t \in T , s \in S
        \end{align*}

        Dass die logische Und-Verknüpfung korrekt ist, zeigt folgende Tabelle (ausgehend für einen willkürlichen Agenten $a$):
        \begin{center}
            \begin{tabular}{|c|c|c||c|c||c|}
                \hline
                $s$ & $t$ & Soll-Wert & $c_1$ & $c_2$ & $c_1 \land c_2$ \\
                \hline
                \hline
                0 & 0 & 1 & 1 & 1 & 1 \\
                \hline
                0 & 1 & 0 & 1 & 0 & 0 \\
                \hline
                1 & 0 & 0 & 0 & 1 & 0 \\
                \hline
                1 & 1 & 1 & 1 & 1 & 1 \\
                \hline
            \end{tabular}
        \end{center}

    \item \textbf{Maximale Anzahl an Schichten}\\
        Jeder Agent darf maximal $S_a = 3$ Schichten pro Tag übernehmen:
        $$\sum_{s \in S} y_{a,s} \leq S_a,\quad\forall a\in A$$
    \item \textbf{Binäre Entscheidungsvariablen}\\
        Die Variablen müssen binär sein:
        $$x_{a,t}, y_{a,s} \in \{0,1\},\quad\forall a,t,s$$
\end{enumerate}

Diese mathematische Formulierung deckt die Anforderungen des Problems ab und dient als präzise Grundlage für die Implementierung eines Optimierungsmodells zur Schichtplanung in Python.


\begin{align*}
    r = round(max(r_{min}, min(r_{max}, r_{max} - \alpha \cdot \text{exceedance} - \beta \cdot \text{error} + c)), 2)
\end{align*}

\begin{longtable}{|l|p{0.8\linewidth}|}
    \hline
    \textbf{Variable} & \textbf{Bedeutung} \\
    \hline
    $r$ & finale Bewertung\\
    \hline
    $r_{min}$ & minimal mögliche Bewertung\\
    \hline
    $r_{max}$ & maximal mögliche Bewertung\\
    \hline
    $\alpha$ & Gewichtung der Wartezeitstrafe\\
    \hline
    exceedance & Quotient aus der tatsächlichen Wartezeit und der angegebenen maximalen Zeit (nur bei Überschreitung, sonst 0)\\
    \hline
    $\beta$ & Gewichtung für fehlerhafte Bestellungen\\
    \hline
    error & zufällige Fehlerquote\\
    \hline
    $c$ & zufällige Bewertungsvariabilität abhängig von der Gruppengröße\\
    \hline
\end{longtable}

